<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FRP隧道配置生成器</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a6c, #2c3e50);
            color: #333;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .container {
            width: 100%;
            max-width: 1100px;
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            margin-top: 20px;
        }
        
        header {
            background: linear-gradient(90deg, #3498db, #2c3e50);
            color: white;
            padding: 25px 30px;
            text-align: center;
        }
        
        header h1 {
            font-size: 2.4rem;
            margin-bottom: 10px;
        }
        
        header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .content {
            display: flex;
            flex-wrap: wrap;
            padding: 0;
        }
        
        .form-section {
            flex: 1;
            min-width: 300px;
            padding: 30px;
            background-color: #f8f9fa;
            border-right: 1px solid #e9ecef;
        }
        
        .result-section {
            flex: 1;
            min-width: 300px;
            padding: 30px;
            display: flex;
            flex-direction: column;
        }
        
        .server-config {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            border: 1px solid #90caf9;
        }
        
        .server-config h2 {
            color: #1565c0;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .server-config h2::before {
            content: "⚙️";
        }
        
        .tunnel-container {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
            border: 1px solid #e9ecef;
            position: relative;
        }
        
        .tunnel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #3498db;
        }
        
        .tunnel-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #2c3e50;
        }
        
        .delete-tunnel {
            background-color: #e74c3c;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 8px 15px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            max-width: 70px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            position: relative;
            -webkit-appearance: none;
        }

        .delete-tunnel:hover {
            background-color: #c0392b;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        .delete-tunnel:active {
            transform: translateY(0);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
        }
        
        .form-group {
            margin-bottom: 22px;
            position: relative;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #ced4da;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        input:focus, select:focus, textarea:focus {
            border-color: #3498db;
            outline: none;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }
        
        .radio-group {
            display: flex;
            gap: 20px;
            margin-top: 8px;
        }
        
        .radio-option {
            display: flex;
            align-items: center;
        }
        
        .radio-option input {
            width: auto;
            margin-right: 8px;
        }
        
        .btn-group {
            display: flex;
            gap: 15px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        button {
            color: white;
            border: none;
            padding: 14px 25px;
            font-size: 18px;
            font-weight: 600;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 150px;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 10px rgba(0, 0, 0, 0.15);
        }
        
        button:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        #add-tunnel {
            background: linear-gradient(90deg, #9b59b6, #8e44ad);
        }
        
        #add-tunnel:hover {
            background: linear-gradient(90deg, #8e44ad, #7d3c98);
        }
        
        #generate-btn {
            background: linear-gradient(90deg, #3498db, #2980b9);
        }
        
        #generate-btn:hover {
            background: linear-gradient(90deg, #2980b9, #2573a7);
        }
        
        #import-btn {
            background: linear-gradient(90deg, #27ae60, #219653);
        }
        
        #import-btn:hover {
            background: linear-gradient(90deg, #219653, #1e8449);
        }
        
        .result-container {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        #config-output {
            flex: 1;
            width: 100%;
            min-height: 350px;
            padding: 18px;
            background-color: #2c3e50;
            color: #f1c40f;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 16px;
            line-height: 1.5;
            white-space: pre-wrap;
            overflow: auto;
            margin-bottom: 20px;
            border: 2px solid #1a2530;
        }
        
        .example-config {
            background-color: #e9f7fe;
            border-left: 4px solid #3498db;
            padding: 16px;
            border-radius: 4px;
            margin-top: 25px;
            font-size: 14px;
        }
        
        .example-config h3 {
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .example-config pre {
            background-color: #d6eaf8;
            padding: 12px;
            border-radius: 4px;
            overflow: auto;
            font-size: 13px;
        }
        
        .port-range {
            display: inline-block;
            background-color: #e74c3c;
            color: white;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 12px;
            margin-left: 8px;
        }
        
        .validation-error {
            color: #e74c3c;
            font-size: 14px;
            margin-top: 5px;
            display: none;
        }
        
        .input-invalid {
            border-color: #e74c3c !important;
            background-color: #fff0f0;
        }
        
        .counter {
            position: absolute;
            right: 10px;
            top: 40px;
            background: #3498db;
            color: white;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 14px;
        }
        
        .info-tip {
            font-size: 14px;
            color: #7f8c8d;
            margin-top: 5px;
            display: block;
        }
        
        .import-section {
            background: #fff8e1;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid #ffd54f;
        }
        
        .import-section h3 {
            color: #e65100;
            margin-bottom: 15px;
        }
        
        @media (max-width: 768px) {
            .content {
                flex-direction: column;
            }
            
            .form-section {
                border-right: none;
                border-bottom: 1px solid #e9ecef;
            }
            
            .btn-group {
                flex-direction: column;
            }
            
            button {
                width: 100%;
                margin-bottom: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>FRP隧道配置生成器</h1>
            <p>创建、管理和还原FRP隧道配置</p>
        </header>
        
        <div class="content">
            <div class="form-section">
                <!-- FRPS服务器配置区域 -->
                <div class="server-config">
                    <h2>FRPS服务器配置</h2>
                    
                    <div class="form-group">
                        <label for="serverAddr">服务器地址</label>
                        <input type="text" id="serverAddr" value="127.0.0.1" placeholder="输入FRPS服务器公网IP或域名" required>
                        <span class="info-tip">示例: 123.45.67.89 或 frp.example.com</span>
                    </div>
                    
                    <div class="form-group">
                        <label for="serverPort">服务器端口</label>
                        <input type="number" id="serverPort" min="1" max="65535" value="7000" placeholder="输入FRPS服务器端口" required>
                        <span class="info-tip">默认端口7000，需与FRPS配置匹配</span>
                    </div>
                    
                    <div class="form-group">
                        <label for="serverToken">认证令牌 (Token) <span style="color:#7f8c8d;font-weight:normal">(可选)</span></label>
                        <input type="text" id="serverToken" placeholder="输入FRPS服务器认证令牌">
                        <span class="info-tip">需与FRPS配置中的token一致</span>
                    </div>
                </div>
                
                <!-- 配置文件导入区域 -->
                <div class="import-section">
                    <h3>配置文件导入</h3>
                    <div class="form-group">
                        <label for="import-config">粘贴配置文件内容</label>
                        <textarea id="import-config" rows="5" placeholder="在此粘贴完整的FRP配置文件内容..."></textarea>
                    </div>
                    <button id="import-btn">导入配置文件</button>
                </div>
                
                <h2>隧道配置信息</h2>
                <p style="margin: 15px 0 25px; color: #7f8c8d;">添加并配置多个隧道，生成统一配置文件</p>
                
                <div id="tunnels-container">
                    <div class="tunnel-container">
                        <div class="tunnel-header">
                            <div class="tunnel-title">隧道 #1</div>
                            <button class="delete-tunnel">删除</button>
                        </div>
                        <div class="form-group">
                            <label for="tunnelName1">隧道名称 <span class="counter">1</span></label>
                            <input type="text" id="tunnelName1" placeholder="输入隧道名称（如：ssh-tunnel）" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="localIP1">本地地址</label>
                            <input type="text" id="localIP1" value="127.0.0.1" placeholder="输入本地IP地址" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="localPort1">本地端口</label>
                            <input type="number" id="localPort1" min="1" max="65535" placeholder="输入本地端口号" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="remotePort1">远程端口 
                                <span class="port-range">范围: 36000-36999</span>
                            </label>
                            <input type="number" id="remotePort1" min="1" max="65535" placeholder="输入远程端口号" required>
                            <div class="validation-error">
                                远程端口必须在36000-36999范围内！
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>服务类型</label>
                            <div class="radio-group">
                                <div class="radio-option">
                                    <input type="radio" id="tcp1" name="serviceType1" value="tcp" checked>
                                    <label for="tcp1">TCP</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" id="udp1" name="serviceType1" value="udp">
                                    <label for="udp1">UDP</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="btn-group">
                    <button id="add-tunnel">+ 添加隧道</button>
                    <button id="generate-btn">生成配置文件</button>
                </div>
                
                <div class="example-config">
                    <h3>配置文件示例</h3>
                    <pre>[common]
serverAddr = "123.45.67.89"
serverPort = 7000
auth.token = "secure_token_123"

[[proxies]]
name = "ssh-tunnel"
type = "tcp"
localIP = "127.0.0.1"
localPort = 22
remotePort = 36022

[[proxies]]
name = "web-server"
type = "tcp"
localIP = "127.0.0.1"
localPort = 80
remotePort = 36080</pre>
                    <p>注意：远程端口必须在36000-36999范围内</p>
                </div>
            </div>
            
            <div class="result-section">
                <h2>生成的FRP配置文件</h2>
                <p style="margin: 15px 0 25px; color: #7f8c8d;">完整的FRP客户端配置将显示在下方</p>
                
                <div class="result-container">
                    <textarea id="config-output" readonly></textarea>
                </div>
            </div>
        </div>
        
        <footer>
            <p>FRP隧道配置生成器 &copy; 2025 | 支持配置生成与还原</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const tunnelsContainer = document.getElementById('tunnels-container');
            const addTunnelBtn = document.getElementById('add-tunnel');
            const generateBtn = document.getElementById('generate-btn');
            const importBtn = document.getElementById('import-btn');
            const configOutput = document.getElementById('config-output');
            const importConfigTextarea = document.getElementById('import-config');
            
            let tunnelCounter = 1;
            
            // 添加隧道
            addTunnelBtn.addEventListener('click', function() {
                tunnelCounter++;
                const newTunnel = document.createElement('div');
                newTunnel.className = 'tunnel-container';
                newTunnel.innerHTML = `
                    <div class="tunnel-header">
                        <div class="tunnel-title">隧道 #${tunnelCounter}</div>
                        <button class="delete-tunnel">删除</button>
                    </div>
                    <div class="form-group">
                        <label for="tunnelName${tunnelCounter}">隧道名称 <span class="counter">${tunnelCounter}</span></label>
                        <input type="text" id="tunnelName${tunnelCounter}" placeholder="输入隧道名称（如：ssh-tunnel）" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="localIP${tunnelCounter}">本地地址</label>
                        <input type="text" id="localIP${tunnelCounter}" value="127.0.0.1" placeholder="输入本地IP地址" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="localPort${tunnelCounter}">本地端口</label>
                        <input type="number" id="localPort${tunnelCounter}" min="1" max="65535" placeholder="输入本地端口号" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="remotePort${tunnelCounter}">远程端口 
                            <span class="port-range">范围: 36000-36999</span>
                        </label>
                        <input type="number" id="remotePort${tunnelCounter}" min="1" max="65535" placeholder="输入远程端口号" required>
                        <div class="validation-error">
                            远程端口必须在36000-36999范围内！
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>服务类型</label>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="tcp${tunnelCounter}" name="serviceType${tunnelCounter}" value="tcp" checked>
                                <label for="tcp${tunnelCounter}">TCP</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="udp${tunnelCounter}" name="serviceType${tunnelCounter}" value="udp">
                                <label for="udp${tunnelCounter}">UDP</label>
                            </div>
                        </div>
                    </div>
                `;
                
                tunnelsContainer.appendChild(newTunnel);
                
                // 添加删除事件
                const deleteBtn = newTunnel.querySelector('.delete-tunnel');
                deleteBtn.addEventListener('click', function() {
                    if (tunnelCounter > 1) {
                        tunnelsContainer.removeChild(newTunnel);
                        tunnelCounter--;
                    } else {
                        alert('至少需要保留一个隧道配置！');
                    }
                });
            });
            
            // 远程端口范围校验函数
            function validateRemotePort(port) {
                return port >= 36000 && port <= 36999;
            }
            
            // 生成配置文件
            generateBtn.addEventListener('click', function() {
                // 获取服务器配置信息
                const serverAddr = document.getElementById('serverAddr').value.trim();
                const serverPort = parseInt(document.getElementById('serverPort').value);
                const serverToken = document.getElementById('serverToken').value.trim();
                
                // 验证服务器配置
                if (!serverAddr || isNaN(serverPort)) {
                    alert('请填写完整的FRPS服务器配置！');
                    return;
                }
                
                if (serverPort < 1 || serverPort > 65535) {
                    alert('服务器端口必须在1-65535范围内！');
                    return;
                }
                
                // 开始生成配置
                let configContent = `[common]\n`;
                configContent += `serverAddr = "${serverAddr}"\n`;
                configContent += `serverPort = ${serverPort}\n`;
                
                // 添加token（如果存在）
                if (serverToken) {
                    configContent += `auth.token = "${serverToken}"\n`;
                }
                
                configContent += `\n`;
                
                let isValid = true;
                let tunnelNames = new Set();
                
                // 获取所有隧道容器
                const tunnelContainers = document.querySelectorAll('.tunnel-container');
                
                for (let i = 0; i < tunnelContainers.length; i++) {
                    const container = tunnelContainers[i];
                    const index = container.querySelector('.counter').textContent;
                    
                    // 获取表单值
                    const tunnelName = document.getElementById(`tunnelName${index}`).value.trim();
                    const localIP = document.getElementById(`localIP${index}`).value.trim();
                    const localPort = parseInt(document.getElementById(`localPort${index}`).value);
                    const remotePort = parseInt(document.getElementById(`remotePort${index}`).value);
                    const serviceType = document.querySelector(`input[name="serviceType${index}"]:checked`).value;
                    
                    // 检查隧道名称是否重复
                    if (tunnelNames.has(tunnelName)) {
                        alert(`隧道名称 "${tunnelName}" 已重复！请为每个隧道使用唯一的名称。`);
                        document.getElementById(`tunnelName${index}`).classList.add('input-invalid');
                        isValid = false;
                        break;
                    }
                    tunnelNames.add(tunnelName);
                    
                    // 验证输入
                    if (!tunnelName || !localIP || isNaN(localPort) || isNaN(remotePort)) {
                        alert(`隧道 #${index}：请填写所有必填字段！`);
                        isValid = false;
                        break;
                    }
                    
                    // 校验本地端口范围
                    if (localPort < 1 || localPort > 65535) {
                        alert(`隧道 #${index}：本地端口必须在1-65535范围内！`);
                        isValid = false;
                        break;
                    }
                    
                    // 校验远程端口范围
                    if (!validateRemotePort(remotePort)) {
                        container.querySelector(`#remotePort${index}`).classList.add('input-invalid');
                        container.querySelector('.validation-error').style.display = 'block';
                        alert(`隧道 #${index}：远程端口必须在36000-36999范围内！`);
                        isValid = false;
                        break;
                    }
                    
                    // 生成配置内容
                    configContent += `[[proxies]]\n`;
                    configContent += `name = "${tunnelName}"\n`;
                    configContent += `type = "${serviceType}"\n`;
                    configContent += `localIP = "${localIP}"\n`;
                    configContent += `localPort = ${localPort}\n`;
                    configContent += `remotePort = ${remotePort}\n\n`;
                }
                
                if (isValid && configContent) {
                    // 显示配置
                    configOutput.value = configContent;
                }
            });
            
            // 配置文件导入功能（修复版）
            importBtn.addEventListener('click', function() {
                const configText = importConfigTextarea.value.trim();
                
                if (!configText) {
                    alert('请粘贴配置文件内容！');
                    return;
                }
                
                try {
                    // 解析配置文件
                    const configData = parseConfig(configText);
                    
                    // 填充服务器配置
                    document.getElementById('serverAddr').value = configData.common.serverAddr || '127.0.0.1';
                    document.getElementById('serverPort').value = configData.common.serverPort || 7000;
                    document.getElementById('serverToken').value = configData.common.token || '';
                    
                    // 移除现有隧道配置
                    while (tunnelsContainer.children.length > 1) {
                        tunnelsContainer.removeChild(tunnelsContainer.lastChild);
                    }
                    tunnelCounter = 1;
                    
                    // 填充隧道配置
                    configData.proxies.forEach((proxy, index) => {
                        if (index > 0) {
                            // 添加新的隧道卡片
                            const addBtn = document.getElementById('add-tunnel');
                            addBtn.click();
                        }
                        
                        // 填充表单
                        document.getElementById(`tunnelName${index + 1}`).value = proxy.name;
                        document.getElementById(`localIP${index + 1}`).value = proxy.localIP;
                        document.getElementById(`localPort${index + 1}`).value = proxy.localPort;
                        document.getElementById(`remotePort${index + 1}`).value = proxy.remotePort;
                        
                        // 设置服务类型
                        const typeRadios = document.querySelectorAll(`input[name="serviceType${index + 1}"]`);
                        typeRadios.forEach(radio => {
                            if (radio.value === proxy.type.toLowerCase()) {
                                radio.checked = true;
                            }
                        });
                    });
                    
                    alert(`成功导入${configData.proxies.length}个隧道配置！`);
                    generateBtn.click();
                } catch (error) {
                    alert(`配置文件解析失败: ${error.message}\n\n错误详情: ${error.details || ''}`);
                }
            });
            
            // 配置文件解析函数（修复版）
            function parseConfig(configText) {
                const result = {
                    common: { serverAddr: "127.0.0.1", serverPort: 7000, token: "" },
                    proxies: []
                };
                
                const lines = configText.split('\n');
                let currentSection = null;
                let currentProxy = null;
                
                for (const line of lines) {
                    const trimmedLine = line.trim();
                    
                    // 跳过空行和注释
                    if (!trimmedLine || trimmedLine.startsWith('#')) continue;
                    
                    // 解析common段
                    if (trimmedLine.startsWith('[common]')) {
                        currentSection = 'common';
                        currentProxy = null;
                        continue;
                    }
                    
                    // 解析proxies段（支持 [[proxies]] 和 [proxies] 格式）
                    if (trimmedLine.startsWith('[[proxies]]') || trimmedLine.startsWith('[proxies]')) {
                        currentSection = 'proxies';
                        currentProxy = {};
                        result.proxies.push(currentProxy);
                        continue;
                    }
                    
                    // 解析键值对
                    const eqIndex = trimmedLine.indexOf('=');
                    if (eqIndex === -1) continue;
                    
                    const key = trimmedLine.substring(0, eqIndex).trim().toLowerCase();
                    let value = trimmedLine.substring(eqIndex + 1).trim();
                    
                    // 去除字符串的引号
                    if (value.startsWith('"') && value.endsWith('"')) {
                        value = value.substring(1, value.length - 1);
                    }
                    
                    // 处理common配置
                    if (currentSection === 'common') {
                        if (key === 'serveraddr') {
                            result.common.serverAddr = value;
                        } else if (key === 'serverport') {
                            result.common.serverPort = parseInt(value);
                        } else if (key === 'token' || key === 'auth.token') {
                            result.common.token = value;
                        }
                    }
                    
                    // 处理proxy配置
                    else if (currentSection === 'proxies' && currentProxy) {
                        if (key === 'name') {
                            currentProxy.name = value;
                        } else if (key === 'type') {
                            currentProxy.type = value.toLowerCase();
                        } else if (key === 'localip' || key === 'local_ip') {
                            currentProxy.localIP = value;
                        } else if (key === 'localport' || key === 'local_port') {
                            currentProxy.localPort = parseInt(value);
                        } else if (key === 'remoteport' || key === 'remote_port') {
                            currentProxy.remotePort = parseInt(value);
                        }
                    }
                }
                
                // 验证解析结果
                if (result.proxies.length === 0) {
                    throw new Error('没有找到隧道配置');
                }
                
                return result;
            }
            
            // 初始删除按钮事件
            document.querySelector('.delete-tunnel').addEventListener('click', function() {
                if (tunnelCounter > 1) {
                    tunnelsContainer.removeChild(document.querySelector('.tunnel-container'));
                    tunnelCounter--;
                } else {
                    alert('至少需要保留一个隧道配置！');
                }
            });
        });
    </script>
</body>
</html>